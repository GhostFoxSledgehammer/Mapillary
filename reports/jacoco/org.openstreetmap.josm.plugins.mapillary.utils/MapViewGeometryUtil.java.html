<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MapViewGeometryUtil.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">josm-mapillary-plugin</a> &gt; <a href="index.source.html" class="el_package">org.openstreetmap.josm.plugins.mapillary.utils</a> &gt; <span class="el_source">MapViewGeometryUtil.java</span></div><h1>MapViewGeometryUtil.java</h1><pre class="source lang-java linenums">// License: GPL. For details, see LICENSE file.
package org.openstreetmap.josm.plugins.mapillary.utils;

import java.awt.Graphics2D;
import java.awt.Point;
import java.awt.Rectangle;
import java.awt.Shape;
import java.awt.geom.Area;
import java.awt.geom.Path2D;

import org.openstreetmap.josm.data.Bounds;
import org.openstreetmap.josm.gui.MapView;
import org.openstreetmap.josm.plugins.mapillary.MapillaryAbstractImage;
import org.openstreetmap.josm.plugins.mapillary.MapillarySequence;

/**
 * Utility class to convert entities like {@link Bounds} and {@link MapillarySequence} into {@link Shape}s that
 * can then easily be drawn on a {@link MapView}s {@link Graphics2D}-context.
 */
public final  class MapViewGeometryUtil {
<span class="nc" id="L21">  private MapViewGeometryUtil() {</span>
    // Private constructor to avoid instantiation
<span class="nc" id="L23">  }</span>

  /**
   * Subtracts the download bounds from the rectangular bounds of the map view.
   * @param mv the MapView that is used for the LatLon-to-Point-conversion and that determines
   *     the Bounds from which the downloaded Bounds are subtracted
   * @param downloadBounds multiple {@link Bounds} objects that represent the downloaded area
   * @return the difference between the {@link MapView}s bounds and the downloaded area
   */
  public static Area getNonDownloadedArea(MapView mv, Iterable&lt;Bounds&gt; downloadBounds) {
<span class="nc" id="L33">    Rectangle b = mv.getBounds();</span>
    // on some platforms viewport bounds seem to be offset from the left,
    // over-grow it just to be sure
<span class="nc" id="L36">    b.grow(100, 100);</span>
<span class="nc" id="L37">    Area a = new Area(b);</span>
    // now successively subtract downloaded areas
<span class="nc bnc" id="L39" title="All 2 branches missed.">    for (Bounds bounds : downloadBounds) {</span>
<span class="nc" id="L40">      Point p1 = mv.getPoint(bounds.getMin());</span>
<span class="nc" id="L41">      Point p2 = mv.getPoint(bounds.getMax());</span>
<span class="nc" id="L42">      Rectangle r = new Rectangle(Math.min(p1.x, p2.x), Math.min(p1.y, p2.y),</span>
<span class="nc" id="L43">          Math.abs(p2.x - p1.x), Math.abs(p2.y - p1.y));</span>
<span class="nc" id="L44">      a.subtract(new Area(r));</span>
<span class="nc" id="L45">    }</span>
<span class="nc" id="L46">    return a;</span>
  }

  /**
   * Converts a {@link MapillarySequence} into a {@link Path2D} that can be drawn
   * on the specified {@link MapView}'s {@link Graphics2D}-context.
   * @param mv the {@link MapView} for which this conversion should be performed
   * @param seq the sequence to convert
   * @return the {@link Path2D} object to which the {@link MapillarySequence} has been converted
   */
  public static Path2D getSequencePath(MapView mv, MapillarySequence seq) {
<span class="nc" id="L57">    Path2D.Double path = new Path2D.Double();</span>
<span class="nc bnc" id="L58" title="All 2 branches missed.">    for (MapillaryAbstractImage img : seq.getImages()) {</span>
<span class="nc bnc" id="L59" title="All 2 branches missed.">      if (img.isVisible()) {</span>
<span class="nc" id="L60">        Point p = mv.getPoint(img.getLatLon());</span>
<span class="nc bnc" id="L61" title="All 2 branches missed.">        if (path.getCurrentPoint() == null) {</span>
<span class="nc" id="L62">          path.moveTo(p.getX(), p.getY());</span>
        } else {
<span class="nc" id="L64">          path.lineTo(p.getX(), p.getY());</span>
        }
      }
<span class="nc" id="L67">    }</span>
<span class="nc" id="L68">    return path;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>