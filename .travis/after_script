#!/usr/bin/env bash
if [ "$TRAVIS_BRANCH" == "master" ] && [ "$TRAVIS_JDK_VERSION" == "openjdk8" ]; then
  git config --global user.email "deploy@travis"
  git config --global user.name "Travis CI"

  # Prevent printout of credentials
  git config --global credential.helper store
  echo "https://${GH_USERNAME}:${GH_TOKEN}@github.com" > $HOME/.git-credentials

  git remote add deploy "https://github.com/JOSM/Mapillary.git"
  git fetch --depth=1 origin gh-pages:gh-pages
  git checkout gh-pages
  git rm -r reports/ docs/
  mkdir -p reports/ docs/
  cp -R build/docs/javadoc/ docs/javadoc/
  cp -R build/reports/tests/ reports/junit/
  cp -R build/reports/jacoco/ reports/jacoco/
  cp -R build/reports/findbugs/ reports/findbugs/
  git stage docs/ reports/
  masterCommit=`git rev-parse master`
  git commit -m "Publish developer resources to GitHub pages

These resources are generated by Travis CI for commit $masterCommit using Gradle."
  git push deploy gh-pages
else
  echo "This is branch $TRAVIS_BRANCH with JDK $TRAVIS_JDK_VERSION, developer resources are only published with openjdk8 on branch master."
fi
