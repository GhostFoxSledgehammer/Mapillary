buildscript {
  repositories {
    maven {
      url "https://floscher.github.io/gradle-josm-plugin/maven"
    }
  }
  dependencies {
    classpath 'org.openstreetmap.josm:gradle-plugin:0.1.2'
  }
}
plugins {
  id "org.sonarqube" version "2.5"
  id "org.kordamp.markdown.convert" version "1.1.0"
  id "com.github.ben-manes.versions" version "0.15.0"
}

apply plugin: 'org.openstreetmap.josm.gradle.plugin'
apply plugin: 'eclipse'
apply plugin: 'findbugs'
apply plugin: 'idea'
apply plugin: 'jacoco'
apply plugin: 'java'
apply plugin: 'pmd'

apply from: 'gradle/version-functions.gradle'
apply from: 'gradle/tool-config.gradle'
apply from: 'gradle/markdown.gradle'

sourceCompatibility = '1.8'
version = getVersionName()

repositories {
  jcenter()
}

dependencies {
  testImplementation (name: 'josm-unittest'){changing=true}
  testImplementation 'junit:junit:4.12'
}

sourceSets {
  main {
    java {
      srcDirs = ['src']
    }
    resources {
      srcDirs = ["$projectDir"]
      include 'data/**'
      include 'images/**'
      include 'LICENSE'
      include 'LICENSE_*'
    }
  }
  test {
    java {
      srcDirs = ['test/unit']
    }
    resources{
      srcDirs = ['test/data']
    }
  }
}

josm {
  debugPort = 7051
  jarName = 'Mapillary.jar'
  manifest.oldVersionDownloadURLs << [
    12128 : new URL('https://github.com/JOSM/Mapillary/releases/download/v1.5.5/Mapillary.jar'),
    10824 : new URL('https://github.com/JOSM/Mapillary/releases/download/v1.5.3/Mapillary.jar')
  ]
}

eclipse {
  project {
    name = 'JOSM-Mapillary'
    comment = property('plugin.description')
    natures 'org.sonarlint.eclipse.core.sonarlintNature', 'ch.acanda.eclipse.pmd.builder.PMDNature', 'org.eclipse.buildship.core.gradleprojectnature'
    buildCommand 'org.sonarlint.eclipse.core.sonarlintBuilder'
    buildCommand 'ch.acanda.eclipse.pmd.builder.PMDBuilder'
    buildCommand 'org.eclipse.buildship.core.gradleprojectbuilder'
  }
}
eclipseClasspath.dependsOn cleanEclipseClasspath
eclipseProject.dependsOn cleanEclipseProject
tasks.eclipse.dependsOn = ['eclipseClasspath', 'eclipseProject']

tasks.withType(Javadoc) {
  failOnError false
}

test {
  testLogging {
    exceptionFormat "full"
    events "passed", "skipped", "failed"
  }
}
